<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
   <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
    }

    body {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      font-family: Arial, sans-serif;
    }

    header {
      padding: 1rem;
      text-align: center;
    }

    main {
      flex: 1;
      padding: 2rem;

    }

    footer {
      background: #222;
      color:aliceblue;
      text-align: center;
      padding: 1rem;
      z-index:99;
    }
  </style>
</head>
<body>
  <header>
    <style>
     @import url("https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;600;700&display=swap");

    :root {
      --color-black: hsl(0, 0%, 10%);
      --color-darks: hsl(0, 0%, 25%);
      --color-greys: hsl(0, 0%, 60%);
      --color-light: hsl(0, 0%, 95%);
      --color-white: hsl(0, 0%, 100%);
      --color-blue-100: hsl(217, 91%, 65%);
      --color-blue-200: hsl(221, 83%, 55%);
      --color-blue-300: hsl(224, 76%, 45%);
      --shadow-medium: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
        0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      
      background-color: var(--color-white);
      color: var(--color-black);
    }

   .menu a {
      text-decoration: none;
      color: inherit;
    }

    header.header {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      background: var(--color-white);
      box-shadow: var(--shadow-medium);
      z-index: 99;
    }

    .nav-container {
      max-width: 1600px;
      font-family: 'Rubik', sans-serif;
      margin: auto;
      padding: 0 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 4rem;
    }

    .brand {
      font-size: 1.6rem;
      font-weight: 600;
      color: var(--color-blue-200);
      text-transform: uppercase;
    }

    .burger {
      display: block;
      width: 1.6rem;
      cursor: pointer;
    }

    .burger-line {
      width: 100%;
      height: 2px;
      background: var(--color-black);
      margin: 5px 0;
      border-radius: 10px;
    }

    .menu {
      position: fixed;
      top: 0;
      left: -100%;
      width: 80%;
      height: 100vh;
      background: var(--color-white);
      box-shadow: var(--shadow-medium);
      transition: 0.3s ease;
      z-index: 11;
    }

    .menu.is-active {
      left: 0;
    }

    .menu-inner {
      padding: 5rem 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .menu-link {
      font-size: 1.1rem;
      font-weight: 500;
      text-transform: uppercase;
      color: var(--color-black);
    }

    .menu-link:hover {
      color: var(--color-blue-200);
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      background: rgba(0, 0, 0, 0.6);
      width: 100%;
      height: 100%;
      opacity: 0;
      visibility: hidden;
      z-index: 10;
      transition: 0.3s ease;
    }

    .overlay.is-active {
      opacity: 1;
      visibility: visible;
    }

    .search-toggle {
      font-size: 1.5rem;
      cursor: pointer;
    }

    .search-block {
      position: fixed;
      top: 0;
      right: -100%;
      width: 100%;
      height: 100vh;
      background: var(--color-white);
      z-index: 99;
      transition: 0.3s ease;
      padding: 1.5rem;
    }

    .search-block.is-active {
      right: 0;
    }
.search-form-container {
  max-width: 600px;
  margin: auto;
  
}
    .search-form {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .search-input {
      flex: 1;
      padding: 0.75rem 1.25rem;
      border: none;
      border-radius: 5px;
      background: var(--color-light);
      font-size: 1rem;
    }

    .search-cancel {
      font-size: 1.5rem;
      cursor: pointer;
    }
.search-block {
  position: fixed;
  top: 0;
  right: -100%;  
  width: 100%;
  height: 100vh;
  background: white;
  z-index: 12;
  transition: 0.3s ease;
  padding: 0.8rem;
}

.search-block.is-active {
  right: 0;  
}
.search-form {
  display: flex;
  gap: 10px;
  align-items: center;
  max-width: 100%;
  flex-wrap: wrap;
}

.search-form {
  display: flex;
  align-items: center;
  gap: 10px;
  max-width: 600px;
  margin: 0 auto;
  font-family: Arial, sans-serif;
}

.back-btn {
  background: none;
  border: none;
  font-size: 22px;
  color: #333;
  cursor: pointer;
  transition: color 0.2s;
}

.back-btn:hover {
  color: #007BFF;
}

.search-input-wrapper {
  position: relative;
  flex: 1;
}

.search-icon {
  position: absolute;
  left: 12px;
  font-size: 18px;
  color: #aaa;
  top: 50%;
  transform: translateY(-50%);
}

.search-input {
  width: 100%;
  padding: 10px 36px 10px 36px;
  border: 1px solid #ccc;
  border-radius: 8px;
  font-size: 16px;
  transition: all 0.3s ease;
}

.search-input:focus {
  border-color: #007BFF;
  box-shadow: 0 0 0 2px #007bff33;
  outline: none;
}

.clear-input {
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  cursor: pointer;
  color: #999;
  font-size: 16px;
  display: none;
}

.clear-input:hover {
  color: #ff4d4d;
}

.search-btn {
  background-color: #007BFF;
  color: white;
  padding: 10px 14px;
  font-size: 18px;
  border: none;
  border-radius: 8px;
  display: flex;
  align-items: center;
  cursor: pointer;
  transition: background 0.3s;
}

.search-btn:hover {
  background-color: #0056b3;
}

    #search-results {
      position: relative;
      margin-top: 2px;
      font-size: 14px;
      color: #333;
      overflow: auto;
      max-height: 500px;
    }
    #search-results div {
    border: 1px solid #333;
    padding: 2px;
  border-bottom: 1px solid #eee;
}
  a:link {text-decoration: none;}
  a:hover { color:#367404}
    mark {
        background-color: yellow;
      color: black;
      padding: 0 2px;
      border-radius: 3px;
    }
    h3 {

    display: block;
    font-size: 1.17em;
    margin-block-start: 0.2rem;
    margin-block-end: 0.1rem;
    margin-inline-start: 0px;
    margin-inline-end: 0px;
    font-weight: bold;
    unicode-bidi: isolate;
}
p {
    display: block;
    margin-block-start: 0.2rem;
    margin-block-end: 0.1rem;
    margin-inline-start: 0px;
    margin-inline-end: 0px;
    unicode-bidi: isolate;
}

.logo-img {
  margin-top:5px;
  width: 200px;}

    @media (min-width: 768px) {
      .burger {
        display: none;
      }

      .menu {
        position: static;
        height: auto;
        width: auto;
        display: flex;
        box-shadow: none;
        background: none;
        left: auto;
      }

      .menu-inner {
        flex-direction: row;
        padding: 0;
        gap: 2rem;
      }

      .overlay {
        display: none;
      }
    }
    
</style>




<head>
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script>
</head>

  <header class="header">
    <div class="nav-container">
      <div class="burger" id="burger">
        <div class="burger-line"></div>
        <div class="burger-line"></div>
        <div class="burger-line"></div> 
      </div>
       <a href="/" class="brand">
        <img class="logo-img" src="/logo/logo-1080x200.png" alt="GAJAB TOOLS"  loading="lazy" />
      </a>
       
      <div class="menu" id="menu">
        <ul class="menu-inner">
          <li><a href="#" onclick="setPreferredHome()" class="menu-link">Switch</a></li>
          <li><a href="/" class="menu-link"> Home</a></li>
          <li> <a href="/pdf-forms/" class="menu-link">Forms</a></li> 
          <li><a href="/baner-poster-update/" class="menu-link">Poster</a></li>
          <li><a href="/last-date/" class="menu-link">Lastdate</a></li>
          <li><a href="/latest-jobs/" class="menu-link">Latest Jobs</a></li>
        </ul>
      </div>
     <i class="bx bx-search search-toggle" id="searchToggle"></i>


<div class="search-block" id="searchBlock">
 <div class="search-form-container">
    <form class="search-form" onsubmit="handleSearch(event)" method="post" action="" name="search-form">
    <input type="hidden" name="TimeStamp" class="Advance" id="timestamp-field">
    <input type="hidden" name="use-in" class="advnce" value="TopSearch">
  <i class="bx bx-arrow-back search-cancel" class="back-btn" id="searchCancel"></i>

  <div class="search-input-wrapper">
    <i class="bx bx-search search-icon"></i>
    <input id="search-query" class="search-input" name="Search" type="text" placeholder="Search..." />
    <span class="clear-input" id="clearInputBtn">тЬХ</span>
  </div>

  <button type="submit" class="search-btn">
    <i class="bx bx-search"></i>
  </button>
    </form>
    <div id="search-results"></div>
    <div id="recent-searches"></div>
    <iframe id="search-iframe" src="/menu" style="display: none; height: 600px; width: 100%; border: none;" name="menu"></iframe>
  </div>
</div>
</div>
  </header>


<div id="installBtn" style="display: none;">
  <img width="30px" src="https://www.yojnaportal.com/logo/logo-100x100.png" alt="App Icon">
  Yojna Portal App <span style="color:blue; font-weight:700;">Install</span>
  <button id="closeInstallBtn" onclick="document.getElementById('installBtn').style.display='none'">тЭМ</button>
</div>

  <div class="overlay" id="overlay"></div>
<script>
function setPreferredHome() {
  const currentPref = localStorage.getItem("preferredHome");
  if (currentPref === "homepage") {
    localStorage.removeItem("preferredHome");
    window.location.href = '/';
  } else {
    localStorage.setItem("preferredHome", "homepage");
    window.location.href = '/homepage/';
  }
}
</script>

 

  </header>
  <main>
    <head>
    <meta name="robots" content="index, follow">
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href=" \css\single-post.css">
    <style>
   </style>
  </head>

    <div class="single-post-header">
        <div class="Post-Date"> Post Date / Update: <strong>01-Jan-0001 00:00:00</strong></div> 
        <nav aria-label="breadcrumb" class="breadcrumbNav">
          <div class="breadcrumb">
            <li><a href="http://localhost:1313/">Home</a> >> </li>
            
            
            
              
            
              
                
                <li><a href="/typing-speed-test">Typing Speed Test</a> >> </li>
              
            
              
                
                <li><a href="/typing-speed-test/hindi-copy">Hindi Copy</a> >> </li>
              
            
              
            
              
            
            <li>Typing test Speed Hindi Tradition -Lassion 2</li>
          </div>
        </nav>
       
    </div>
    <div class="single-post-wrapper">
      <div class="single-post-content">

        
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Typing Tutor - Paragraph Mode</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f7f9fc; margin:0; padding:20px; text-align:center;}
    h1 { margin-bottom:10px; }
      #text {
      max-width:700px; 
      margin:20px auto; 
      font-size:30px; 
      line-height:1.6;
      text-align:left; 
      background:#fff; 
      padding:15px; 
      border-radius:10px;
      box-shadow:0 0 10px rgba(0,0,0,0.1); 
      white-space:pre-wrap;
      height:3.2em;   /* рдХреЗрд╡рд▓ 2 рд▓рд╛рдЗрди рдХреА рдКрдБрдЪрд╛рдИ */
      overflow:hidden; /* рдХреЗрд╡рд▓ 2 рд▓рд╛рдЗрди рджрд┐рдЦреЗрдВ */
      transition: font-size 0.3s ease;
    }
 .controls {
      text-align:center;
      margin-top:10px;
    }

    .controls button {
      font-size:18px;
      padding:5px 10px;
      margin:0 5px;
      border:none;
      background:#007bff;
      color:#fff;
      border-radius:5px;
      cursor:pointer;
    }

    .controls button:hover {
      background:#0056b3;
    }

    .correct { font-weight: bold; color:green; }
    .incorrect { font-weight: bold;  color:red; }
    .active { background:yellow; padding:1px 2px; border-radius:3px; font-weight:bold; }
    #input {
      width:90%; max-width:700px; padding:10px; font-size:26px; margin-top:20px;
      border:2px solid #007bff; border-radius:6px; font-weight: bold;
    }
    #stats { margin-top:20px; font-size:18px; }
    #result { display:none; margin-top:25px; }
    table {
      margin:20px auto; border-collapse:collapse; width:400px; background:#fff;
      box-shadow:0 0 10px rgba(0,0,0,0.1); border-radius:8px; overflow:hidden;
    }
    td { padding:12px 15px; border:1px solid #ddd; font-size:16px; }
    td:first-child { font-weight:bold; background:#f0f4ff; width:180px; text-align:left; }
    textarea { margin:auto; }
    #restartBtn {
      display:none; margin-top:15px; padding:10px 20px; font-size:16px;
      border:none; border-radius:6px; background:#007bff; color:white; cursor:pointer;
    }

#popupForm {
  display: none; 
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7);
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.popup-content {
  background: white;
  padding: 20px;
  border-radius: 5px;
  width: 300px;
  text-align: center;
}

.popup-content h2 {
  margin: 0;
  padding: 10px 0;
}

.popup-content form {
  display: flex;
  flex-direction: column;
}

.popup-content input, .popup-content textarea {
  padding: 8px;
  margin: 10px 0;
  border: 1px solid #ccc;
  border-radius: 5px;
}


.close-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  font-size: 30px;
  cursor: pointer;
}

.close-btn:hover {
  color: red;
}
   .timebtn, .wpwbtn, .accbtn {
  padding: 8px 5px;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
  font-weight: bold;
  box-shadow: 0 4px 6px rgba(0,0,0,0.2);
  transition: all 0.3s ease;
  margin: 5px;
}
/* рдЕрд▓рдЧ-рдЕрд▓рдЧ рд░рдВрдЧ */
.timebtn {
  border:1px solid #ff9800; /* Orange */
  
}
.accbtn {
   border:1px solid #2196f3;
}

.wpwbtn {
  border:1px solid #4caf50;
}


.dropdown {
  position: relative;
  display: inline-block;
}

.dropdown-content {
  display: none;
  position: absolute;
  background-color: #f1f1f1;
  min-width: 160px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1;
}

.dropdown-content a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
  font-weight: bold;
}

.dropdown-content a:hover {background-color: #ff9800;}

.dropdown:hover .dropdown-content {display: block;}

.dropdown:hover .dropbtn {background-color: #3e8e41;}
.dark-mode {
  background:#222;
  color:#fff;
}

.dark-mode #text,
.dark-mode table,
.dark-mode .dropdown-content,
.dark-mode .popup-content {
  background-color: #333;
  color: white;
  border-color: #444;
}
.dark-mode td:first-child {
    color: black;
    width: 180px;
   
}

.dark-mode .correct { color: #4caf50; }
.dark-mode .incorrect { color: #f44336; }
.dark-mode .active { background: #ffff00; color:#000; }

.dark-mode textarea,
.dark-mode input,
.dark-mode button {
  background: #555;
  color: white;
}
#finishBtn {
  position: fixed;
  bottom: 25px;
  right: 25px;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: #e91e63;
  color: #fff;
  border: none;
  font-size: 24px;
  cursor: pointer;
  box-shadow: 0 6px 15px rgba(0,0,0,0.25);
  display: none;
  transition: all 0.3s ease;
  z-index: 100;
}
#finishBtn:hover {
  background: #c2185b;
  transform: scale(1.1);
}
#modeToggleBtn {
  background:#9c27b0;
}
.dark-mode #modeToggleBtn {
  background:#7b1fa2;
}
/* тЬЕ Result Page Animation */
#result {
  display: none;
  opacity: 0;
  transform: translateY(30px);
  transition: opacity 0.6s ease, transform 0.6s ease;
}
#result.show {
  display: block;
  opacity: 1;
  transform: translateY(0);
}
/* тЬЕ CSS рд╕реЗ Show/Hide Transition */
#detailedReport {
  overflow: hidden;
  transition: all 0.5s ease;
  opacity: 1;
}
#detailedReport.hidden {
  opacity: 0;
  max-height: 0;
  pointer-events: none;
}
.halfwrong {
  font-weight: bold;
  color: orange;
}
  </style>
</head>
<body>

  <h1>Typing Speed Test -Gajab Tools </h1>


  <div id="stats">

    <button class="accbtn" id="openFormBtn">тЮХAdd Name/Lassion</button>
    <div class="dropdown">
      
 <span class="timebtn">  тП│ Time Left: <span id="time" style="color: #ff9800;">10:00</span>  </span>
  <div class="dropdown-content">
     <a href="#">01:00</a>
    <a href="#">02:00</a>
     <a href="#">03:00</a> 
    <a href="#">05:00</a>
      <a href="#">10:00</a>
    <a href="#">20:00</a>
     <a href="#">30:00</a>
      <a href="#">60:00</a>
  </div>
</div>
   <button onclick="toggleDarkMode()" class="wpwbtn">ЁЯМУ Toggle Dark Mode</button>
   <button class="accbtn" id="modeToggleBtn" onclick="toggleMode()">ЁЯФд Mode: Character</button>
   <button class="timebtn" id="backspaceToggleBtn" onclick="toggleBackspace()">тМл Backspace: ON</button>
    <span class="wpwbtn"> тМия╕П WPM: <span id="wpm" style="color: #4caf50;">0</span>  </span> 
     <span class="accbtn">ЁЯОп Accuracy: <span id="accuracy" style="color: #2196f3;">100</span>%  </span>
       <span class="wpwbtn">тнР Best Score: <span id="bestScore" style="color:#ff9800;">0</span> WPM </span>
 <div class="controls">
   
    <button onclick="changeSize(-2)">-</button>
    <button onclick="resetSize()">тЦа</button>
     <button onclick="changeSize(2)">+</button>
     <!-- тЬЕ рдирдпрд╛ рдмрдЯрди -->
 <button id="finishBtn" onclick="toggleTest()" data-title="Start / Stop Test">тЦ╢</button>
  </div>
  </div>

  <!-- Pop-up form -->
  <div id="popupForm" class="popup-form">
    <div class="popup-content">
      <span id="closeBtn" class="close-btn">&times;</span>
      <h2>Add Your Name & Your Passage</h2>
   <div style="margin:20px auto; max-width:700px; text-align:left;">
  <label><b>Enter Your Name:</b></label>
  <input type="text" id="userName" placeholder="Your Name" style="padding:6px; width:200px; margin-left:10px;" />
  <button onclick="saveUserName()">ЁЯТ╛ Save Name</button>
  <!-- User Passage Input -->
<div style="margin:20px auto; max-width:700px; text-align:left;">
  <label><b>Paste Your Passage:</b></label><br>
  <textarea id="customPassage" rows="4" style="width:100%; margin-top:5px; padding:8px;" placeholder="Paste your text here..."></textarea><br>
  <button onclick="useCustomPassage()" >тЬЕ Use Your Passage </button> 
</div>
</div>
    </div>
  </div>

  <div id="text"></div>
 <div id="progressBar" style="width:90%; max-width:700px; height:8px; background:#ddd; margin:0px auto 0px auto; border-radius:4px;">
  <div id="progress" style="height:100%; width:100%; background:#ff9800; border-radius:4px;"></div>
</div>
  <textarea id="input" rows="1" placeholder="Start typing here..."></textarea>


  <div id="result"></div>
    <button id="restartBtn">ЁЯФД Try Again</button>

 <div id="historyTable" style="margin-top:40px;"></div>

<!-- ЁЯУИ Chart Sections -->
<div style="max-width:700px;margin:50px auto;">
  <h3>ЁЯУИ Best WPM (Last 30 Days)</h3>
  <canvas id="wpmChart" height="120"></canvas>
</div>

<div style="max-width:700px;margin:50px auto;">
  <h3>ЁЯХТ All Tests (Last 24 Hours)</h3>
  <canvas id="recentChart" height="120"></canvas>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// --- Unicode-safe Hindi grapheme utils ---
const _seg = (Intl && Intl.Segmenter)
  ? new Intl.Segmenter('hi', { granularity: 'grapheme' })
  : null;

function toGraphemes(str) {
  // NFC рд╕реЗ canonical normalize + ZWJ/ZWNJ рд╣рдЯрд╛рдПрдБ
  const s = (str || '').normalize('NFC').replace(/[\u200C\u200D]/g, '');
  if (_seg) return Array.from(_seg.segment(s), x => x.segment);
  // Fallback: Array.from codepoints (рдХрдо рд╕рд╣реА, рдкрд░ рдмреЗрд╣рддрд░ than split(""))
  return Array.from(s);
}
</script>

<script>
  document.addEventListener('keydown', function(e){
    if(e.key === "Escape") {
      initTest(); // ESC to restart
    }
    if(e.ctrlKey && e.key === "Enter") {
      finishTest(); // Ctrl+Enter to finish test
    }
    if(e.key === "Tab") {
      e.preventDefault(); // prevent tab jump
      input.focus(); // focus on typing input
    }
  });
</script>

  <script>
    const defaultSize = 30; // px

    function changeSize(delta) {
      const text = document.getElementById("text");
      let current = parseInt(window.getComputedStyle(text).fontSize);
      let newSize = current + delta;
      if (newSize >= 12 && newSize <= 80) { // limit
        text.style.fontSize = newSize + "px";
      }
    }

    function resetSize() {
      const text = document.getElementById("text");
      text.style.fontSize = defaultSize + "px";
    }
  </script>
<script>
const lessons = [
`рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ
рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ
рдкреЛрддрд╛ рдкреМрддреНрд░ рдкреЛрддрд╛ рдкреМрддреНрд░ рдкреЛрддрд╛ рдкреМрддреНрд░ рдкреЛрддрд╛ рдкреМрддреНрд░ рдкреЛрддрд╛ рдкреМрддреНрд░ рдкреЛрддрд╛ рдкреМрддреНрд░ рдкреЛрддрд╛ рдкреМрддреНрд░ рдкреЛрддрд╛ рдкреМрддреНрд░ рдкреЛрддрд╛ рдкреМрддреНрд░
рдЪреЛрдкрд░ рдЪреМрддрд░ рдЪреЛрдкрд░ рдЪреМрддрд░ рдЪреЛрдкрд░ рдЪреМрддрд░ рдЪреЛрдкрд░ рдЪреМрддрд░ рдЪреЛрдкрд░ рдЪреМрддрд░ рдЪреЛрдкрд░ рдЪреМрддрд░ рдЪреЛрдкрд░ рдЪреМрддрд░ рдЪреЛрдкрд░ рдЪреМрддрд░ рдЪреЛрдкрд░ рдЪреМрддрд░
рд░реЛрдЪрдХ рдкреБрддреНрддрд░ рд░реЛрдЪрдХ рдкреБрддреНрддрд░ рд░реЛрдЪрдХ рдкреБрддреНрддрд░ рд░реЛрдЪрдХ рдкреБрддреНрддрд░ рд░реЛрдЪрдХ рдкреБрддреНрддрд░ рд░реЛрдЪрдХ рдкреБрддреНрддрд░ рд░реЛрдЪрдХ рдкреБрддреНрддрд░ рд░реЛрдЪрдХ рдкреБрддреНрддрд░
рдХреБрд░реБ рдЪреМрдХ рдкрд░ рдЯрдХреНрдХрд░ рд░реЛрддрд┐ рдкрдкреНрдкрд┐ рдХреБрд░реБ рдЪреМрдХ рдкрд░ рдЯрдХреНрдХрд░ рд░реЛрддрд┐ рдкрдкреНрдкрд┐ рдХреБрд░реБ рдЪреМрдХ рдкрд░ рдЯрдХреНрдХрд░ рд░реЛрддрд┐ рдкрдкреНрдкрд┐`,

`рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ
рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ
рдЪреБрдХрддрд┐ рдкрдХреНрдХрд┐ рдЪреБрдХрддрд┐ рдкрдХреНрдХрд┐ рдЪреБрдХрддрд┐ рдкрдХреНрдХрд┐ рдЪреБрдХрддрд┐ рдкрдХреНрдХрд┐ рдЪреБрдХрддрд┐ рдкрдХреНрдХрд┐рдЪреБрдХрддрд┐ рдкрдХреНрдХрд┐ рдЪреБрдХрддрд┐ рдкрдХреНрдХрд┐
рдЯреЛрдХрд░рд┐ рдЯрдкрдХрд┐ рдЯреЛрдХрд░рд┐ рдЯрдкрдХрд┐ рдЯреЛрдХрд░рд┐ рдЯрдкрдХрд┐ рдЯреЛрдХрд░рд┐ рдЯрдкрдХрд┐ рдЯреЛрдХрд░рд┐ рдЯрдкрдХрд┐ рдЯреЛрдХрд░рд┐ рдЯрдкрдХрд┐ рдЯреЛрдХрд░рд┐ рдЯрдкрдХрд┐
рд░реЛрдЪрдХ рдЪреМрдкрд░ рд░реЛрдЪрдХ рдЪреМрдкрд░ рд░реЛрдЪрдХ рдЪреМрдкрд░ рд░реЛрдЪрдХ рдЪреМрдкрд░ рд░реЛрдЪрдХ рдЪреМрдкрд░ рд░реЛрдЪрдХ рдЪреМрдкрд░ рд░реЛрдЪрдХ рдЪреМрдкрд░ рд░реЛрдЪрдХ рдЪреМрдкрд░
рдХреБрд░реБ рдЪреМрдХ рдкрд░ рдЯрдХреНрдХрд░ рд░реЛрддрд┐ рдкрдкреНрдкрд┐ рдХреБрд░реБ рдЪреМрдХ рдкрд░ рдЯрдХреНрдХрд░ рд░реЛрддрд┐ рдкрдкреНрдкрд┐ рдХреБрд░реБ рдЪреМрдХ рдкрд░ рдЯрдХреНрдХрд░ рд░реЛрддрд┐ рдкрдкреНрдкрд┐`,

`рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ
рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ
рдЯреЛрдкрд┐ рд░реЗрдЯ рдЯреЛрдкрд┐ рд░реЗрдЯ рдЯреЛрдкрд┐ рд░реЗрдЯ рдЯреЛрдкрд┐ рд░реЗрдЯ рдЯреЛрдкрд┐ рд░реЗрдЯ рдЯреЛрдкрд┐ рд░реЗрдЯ рдЯреЛрдкрд┐ рд░реЗрдЯ рдЯреЛрдкрд┐ рд░реЗрдЯ рдЯреЛрдкрд┐ рд░реЗрдЯ рдЯреЛрдкрд┐ рд░реЗрдЯ рдЯреЛрдкрд┐ рд░реЗрдЯ
рдЯреЛрдХрд░рд┐ рдЪреМрдХрд░рд┐ рдЯреЛрдХрд░рд┐ рдЪреМрдХрд░рд┐ рдЯреЛрдХрд░рд┐ рдЪреМрдХрд░рд┐ рдЯреЛрдХрд░рд┐ рдЪреМрдХрд░рд┐ рдЯреЛрдХрд░рд┐ рдЪреМрдХрд░рд┐ рдЯреЛрдХрд░рд┐ рдЪреМрдХрд░рд┐ рдЯреЛрдХрд░рд┐ рдЪреМрдХрд░рд┐
рдХреБрд░реБ рдЪреМрдХ рдкрд░ рдЯрдХреНрдХрд░ рд░реЛрддрд┐ рдкрдкреНрдкрд┐ рдХреБрд░реБ рдЪреМрдХ рдкрд░ рдЯрдХреНрдХрд░ рд░реЛрддрд┐ рдкрдкреНрдкрд┐ рдХреБрд░реБ рдЪреМрдХ рдкрд░ рдЯрдХреНрдХрд░ рд░реЛрддрд┐ рдкрдкреНрдкрд┐`,

`рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ
рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ
рдЯреБрдХрд░реЗ рдХреМрдЪрд░ рдЯреБрдХрд░реЗ рдХреМрдЪрд░ рдЯреБрдХрд░реЗ рдХреМрдЪрд░ рдЯреБрдХрд░реЗ рдХреМрдЪрд░ рдЯреБрдХрд░реЗ рдХреМрдЪрд░ рдЯреБрдХрд░реЗ рдХреМрдЪрд░ рдЯреБрдХрд░реЗ рдХреМрдЪрд░ рдЯреБрдХрд░реЗ рдХреМрдЪрд░
рдХреБрд░реБрддрд┐ рдкреНрд░рдХрддрд┐ рдХреБрд░реБрддрд┐ рдкреНрд░рдХрддрд┐ рдХреБрд░реБрддрд┐ рдкреНрд░рдХрддрд┐ рдХреБрд░реБрддрд┐ рдкреНрд░рдХрддрд┐ рдХреБрд░реБрддрд┐ рдкреНрд░рдХрддрд┐ рдХреБрд░реБрддрд┐ рдкреНрд░рдХрддрд┐ рдХреБрд░реБрддрд┐ рдкреНрд░рдХрддрд┐
рдХреБрд░реБ рдЪреМрдХ рдкрд░ рдЯрдХреНрдХрд░ рд░реЛрддрд┐ рдкрдкреНрдкрд┐ рдХреБрд░реБ рдЪреМрдХ рдкрд░ рдЯрдХреНрдХрд░ рд░реЛрддрд┐ рдкрдкреНрдкрд┐ рдХреБрд░реБ рдЪреМрдХ рдкрд░ рдЯрдХреНрдХрд░ рд░реЛрддрд┐ рдкрдкреНрдкрд┐`,

`рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ
рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ
рдкреБрддреНрддрд░ рдХрдЯреНрдЯрд░ рдкреБрддреНрддрд░ рдХрдЯреНрдЯрд░ рдкреБрддреНрддрд░ рдХрдЯреНрдЯрд░ рдкреБрддреНрддрд░ рдХрдЯреНрдЯрд░ рдкреБрддреНрддрд░ рдХрдЯреНрдЯрд░ рдкреБрддреНрддрд░ рдХрдЯреНрдЯрд░ рдкреБрддреНрддрд░ рдХрдЯреНрдЯрд░ рдкреБрддреНрддрд░ рдХрдЯреНрдЯрд░
рдЯреНрд░рдХ рдХреА рдЯрдХреНрдХрд░ рдЯреНрд░рдХ рдХреА рдЯрдХреНрдХрд░ рдЯреНрд░рдХ рдХреА рдЯрдХреНрдХрд░ рдЯреНрд░рдХ рдХреА рдЯрдХреНрдХрд░ рдЯреНрд░рдХ рдХреА рдЯрдХреНрдХрд░ рдЯреНрд░рдХ рдХреА рдЯрдХреНрдХрд░
рдХреБрд░реБ рдЪреМрдХ рдкрд░ рдЯрдХреНрдХрд░ рд░реЛрддрд┐ рдкрдкреНрдкрд┐ рдХреБрд░реБ рдЪреМрдХ рдкрд░ рдЯрдХреНрдХрд░ рд░реЛрддрд┐ рдкрдкреНрдкрд┐ рдХреБрд░реБ рдЪреМрдХ рдкрд░ рдЯрдХреНрдХрд░ рд░реЛрддрд┐ рдкрдкреНрдкрд┐`,

`рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ рдЯреМрдЪреЛ рддреЗрдХреНрд░рд┐рдкреБ
рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ рдкреБрд░рд┐рдХреНрддреЗ рдЪреЛрдЯреМ
рдЪреМрдХрддреЗ рдкреБрддреНрд░ рдЪреМрдХрддреЗ рдкреБрддреНрд░ рдЪреМрдХрддреЗ рдкреБрддреНрд░ рдЪреМрдХрддреЗ рдкреБрддреНрд░ рдЪреМрдХрддреЗ рдкреБрддреНрд░ рдЪреМрдХрддреЗ рдкреБрддреНрд░ рдЪреМрдХрддреЗ рдкреБрддреНрд░ рдЪреМрдХрддреЗ рдкреБрддреНрд░ рдЪреМрдХрддреЗ рдкреБрддреНрд░
рдЯреЛрдЯрдХреЗ рдХреБрддреНрддреЗ рдЯреЛрдЯрдХреЗ рдХреБрддреНрддреЗ рдЯреЛрдЯрдХреЗ рдХреБрддреНрддреЗ рдЯреЛрдЯрдХреЗ рдХреБрддреНрддреЗ рдЯреЛрдЯрдХреЗ рдХреБрддреНрддреЗ рдЯреЛрдЯрдХреЗ рдХреБрддреНрддреЗ рдЯреЛрдЯрдХреЗ рдХреБрддреНрддреЗ рдЯреЛрдЯрдХреЗ рдХреБрддреНрддреЗ рдЯреЛрдЯрдХреЗ рдХреБрддреНрддреЗ
рдХреБрд░реБ рдЪреМрдХ рдкрд░ рдЯрдХреНрдХрд░ рд░реЛрддрд┐ рдкрдкреНрдкрд┐ рдХреБрд░реБ рдЪреМрдХ рдкрд░ рдЯрдХреНрдХрд░ рд░реЛрддрд┐ рдкрдкреНрдкрд┐ рдХреБрд░реБ рдЪреМрдХ рдкрд░ рдЯрдХреНрдХрд░ рд░реЛрддрд┐ рдкрдкреНрдкрд┐`
]

// ЁЯФ╣ Global Variables
let textToType, chars;   
let startTime, timer, started = false;
let timeLimit = 600;
let timeLeft = timeLimit;
let correctChars = 0, wrongChars = 0;
let backspaceCount = 0;  // тЬЕ Backspace counter (global)

const textDiv = document.getElementById("text");
const input = document.getElementById("input");
const timeSpan = document.getElementById("time");
const wpmSpan = document.getElementById("wpm");
const accSpan = document.getElementById("accuracy");
const resultDiv = document.getElementById("result");
const restartBtn = document.getElementById("restartBtn");

// тП│ Format Time
function formatTime(seconds) {
  let m = Math.floor(seconds / 60);
  let s = seconds % 60;
  return (m < 10 ? "0" + m : m) + ":" + (s < 10 ? "0" + s : s);
}

// ЁЯзй Initialize new test
function initTest() {
  textToType = lessons[Math.floor(Math.random() * lessons.length)];
  chars = toGraphemes(textToType);
  started = false;
  timeLeft = timeLimit;
  correctChars = 0;
  wrongChars = 0;
  backspaceCount = 0; // тЬЕ Reset counter

  input.value = "";
  input.disabled = false;
  document.getElementById("stats").style.display = "block";
  document.getElementById("result").style.display = "none";
  restartBtn.style.display = "none";
  textDiv.style.display = "block";
  input.style.display = "block";
  renderText([]);
 timeSpan.textContent = formatTime(timeLimit);
  wpmSpan.textContent = 0;
  accSpan.textContent = 100;
  document.getElementById("finishBtn").style.display = "inline-block";
}

// ЁЯХР Update Stats Every Second
function updateStats() {
  if (timeLeft <= 0) {
    finishTest();
    return;
  }
  timeLeft--;
  timeSpan.textContent = formatTime(timeLeft);
  document.getElementById("progress").style.width = (timeLeft / timeLimit) * 100 + "%";

  let elapsed = (new Date() - startTime) / 1000;
  let wpm = (correctChars / 5) / (elapsed / 60);
  let accuracy = (correctChars + wrongChars)
    ? (correctChars / (correctChars + wrongChars)) * 100
    : 100;

  wpmSpan.textContent = wpm.toFixed(0);
  accSpan.textContent = accuracy.toFixed(0);
}

// ЁЯЯб Render Text (Character or Word Mode)
function renderText() {
  const typedGraphemes = toGraphemes(input.value);

  if (typingMode === "word") {
    // ЁЯФ╣ Word Mode (рдЬреИрд╕рд╛ рдкрд╣рд▓реЗ рдерд╛)
    const words = textToType.split(/\s+/);
    const typedWords = input.value.trim().split(/\s+/);
    const currentWordIndex = input.value.endsWith(" ")
      ? typedWords.length
      : typedWords.length - 1;

    textDiv.innerHTML = words
      .map((word, i) => {
        let cls = "";
        if (typedWords[i] == null) cls = "";
        else if (typedWords[i] === word) cls = "correct";
        else cls = "incorrect";
        return i === currentWordIndex
          ? `<span class="active">${word}</span>`
          : `<span class="${cls}">${word}</span>`;
      })
      .join(" ");
  } 
  else {
    // ЁЯФ╕ Character Mode (updated рдорд╛рддреНрд░рд╛ logic)
   // ЁЯФ╕ Character Mode (fixed рдорд╛рддреНрд░рд╛ logic + last-letter fix)
textDiv.innerHTML = chars.map((g, i) => {
  const typed = typedGraphemes[i];
  let cls = "";

  if (typed == null) {
    cls = "";
  } else {
    const t = typed.normalize("NFC");
    const target = g.normalize("NFC");

    const consonantRegex = /[\u0915-\u0939\u0958-\u095f\u0978-\u097f]/;
    const matraRegex     = /[\u093e-\u094c\u0962\u0963]/;

    const gCons  = (target.match(consonantRegex)?.[0]) || "";
    const gMatra = (target.match(matraRegex)?.[0])     || "";
    const tCons  = (t.match(consonantRegex)?.[0])      || "";
    const tMatra = (t.match(matraRegex)?.[0])          || "";

    const isConsonantTarget = !!gCons;
    const matraExpected = gMatra !== "";
    const matraOk = matraExpected ? (tMatra === gMatra) : (tMatra === "");

    // non-consonant (space, punctuation, independent vowels, newline) тЖТ direct equality
    if (!isConsonantTarget) {
      cls = (t === target) ? "correct" : "incorrect";
    } else {
      const consCorrect = (tCons === gCons);
      if (consCorrect && matraOk) {
        cls = "correct";                 // тЬЕ base + (expected) matra рдареАрдХ
      } else if (consCorrect && !matraOk) {
        // рдорд╛рддреНрд░рд╛ expected рдереА рдкрд░ рдЕрднреА рд╕рд╣реА/рдкреВрд░реА рдирд╣реАрдВ рд╣реИ
        const nextTypedExists = !!typedGraphemes[i + 1];
        cls = nextTypedExists ? "incorrect" : "halfwrong"; // тП│ рдЕрднреА incomplete рддреЛ orange, рдЖрдЧреЗ рдмрдврд╝ рдЧрдП рддреЛ red
      } else {
        cls = "incorrect";               // тЭМ base рд╣реА рдЧрд▓рдд
      }
    }
  }

  const displayChar = (g === "\n")
  ? "<span style='color:#999;'>тЖ▓</span><br>"
  : g;
  return i === typedGraphemes.length
    ? `<span id="activeChar" class="active">${displayChar}</span>`
    : `<span class="${cls}">${displayChar}</span>`;
}).join("");

  }

  // рд╕реНрдХреНрд░реЙрд▓ рдПрдбрдЬрд╕реНрдЯ
  const activeEl = document.querySelector(".active");
  if (activeEl) {
    let offset = activeEl.offsetTop - textDiv.offsetTop;
    textDiv.scrollTop = offset - 25;
  }
}



// ЁЯза Typing Input Logic
input.addEventListener("input", (e) => {
  const val = e.target.value;
  const typedGraphemes = toGraphemes(val);

  if (!started && val.length > 0) {
    started = true;
    startTime = new Date();
    timer = setInterval(updateStats, 1000);
  }

  renderText();
  correctChars = 0;
  wrongChars = 0;

  if (typingMode === "character") {
    typedGraphemes.forEach((g, i) => {
      if (g === chars[i]) correctChars++;
      else wrongChars++;
    });
  } else {
    const typedWords = val.trim().split(/\s+/);
    const targetWords = textToType.trim().split(/\s+/);
    typedWords.forEach((word, i) => {
      if (word === targetWords[i]) correctChars += word.length + 1;
      else wrongChars += word.length + 1;
    });
  }

  // ЁЯФБ Auto Repeat logic тАФ 50 words before ending
  const totalWords = textToType.trim().split(/\s+/).length;
  const typedWords = val.trim().split(/\s+/).length;

let repeatThreshold = Math.max(30, Math.floor(totalWords * 0.1)); // рдХреБрд▓ рд╢рдмреНрджреЛрдВ рдХрд╛ 10%, рдХрдо рд╕реЗ рдХрдо 30
if (totalWords - typedWords <= repeatThreshold) {
  textToType += "\n\n" + textToType;
  chars = toGraphemes(textToType);
  renderText();
}
});




// тЬЕ Global Backspace Counter (works everywhere)
document.addEventListener("keydown", function (e) {
  if (e.key === "Backspace" && !e.repeat) {
    backspaceCount++;
  }
});

</script>

<script>
function finishTest(){
  clearInterval(timer);
  input.disabled = true;
  document.getElementById("finishBtn").style.display = "none";
  if (correctChars + wrongChars === 0) return;

  textDiv.style.display = "none";
  input.style.display = "none";
  document.getElementById("stats").style.display = "none";

  resultDiv.classList.remove("show");
  resultDiv.style.display = "block";
  setTimeout(() => resultDiv.classList.add("show"), 50);
  restartBtn.style.display = "inline-block";

  let elapsed = (new Date() - startTime) / 1000; // total seconds
  let hours = Math.floor(elapsed / 3600);
  let minutes = Math.floor((elapsed % 3600) / 60);
  let seconds = Math.floor(elapsed % 60);
  let formattedTime = 
      `${hours.toString().padStart(2, '0')}:` +
      `${minutes.toString().padStart(2, '0')}:` +
      `${seconds.toString().padStart(2, '0')}`; // тЬЕ HH:MM:SS format

  let wpm = (correctChars / 5) / (elapsed / 60);
  let accuracy = (correctChars + wrongChars)
    ? (correctChars / (correctChars + wrongChars)) * 100
    : 100;
  let totalTyped = correctChars + wrongChars;

  updateBestScore(wpm.toFixed(0));

  resultDiv.innerHTML = `
    <h2>ЁЯУК Test Result</h2>
    <table>
      <tr><td>Typing Speed</td><td>${wpm.toFixed(0)} WPM</td></tr>
      <tr><td>Accuracy</td><td>${accuracy.toFixed(0)}%</td></tr>
      <tr><td>Time Taken</td><td>${formattedTime}</td></tr> <!-- тЬЕ HH:MM:SS -->
      <tr><td>Total Typed Characters</td><td>${totalTyped}</td></tr>
      <tr><td>Correct Characters</td><td style="color:green;">${correctChars}</td></tr>
      <tr><td>Wrong Characters</td><td style="color:red;">${wrongChars}</td></tr>
      <tr><td>Correct Words</td><td style="color:green;">${Math.round(correctChars / 5)}</td></tr>
      <tr><td>Wrong Words</td><td style="color:red;">${Math.round(wrongChars / 5)}</td></tr>
      <tr><td>Backspace Used</td><td>${backspaceCount}</td></tr>
    </table>
  `;

  saveHistory({
    wpm: wpm.toFixed(0),
    accuracy: accuracy.toFixed(0),
    time: elapsed.toFixed(0),
    totalTyped,
    correct: correctChars,
    wrong: wrongChars,
    backspace: backspaceCount,
    date: new Date().toLocaleString()
  });

  renderHistory();
  document.getElementById("finishBtn").textContent = "тЦ╢я╕П";
  testRunning = false;
}
</script>




<script>
// тЬЕ Improved saveHistory(): рдЕрдм Backspace рднреА рд╕реЗрд╡ рд╣реЛрдЧрд╛
function saveHistory(entry){
  let history = JSON.parse(localStorage.getItem("typingHistory") || "[]");
  
  // тЬЕ Words calculation
  entry.totalWords = Math.round(entry.totalTyped / 5);
  entry.correctWords = Math.round(entry.correct / 5);
  entry.wrongWords = Math.round(entry.wrong / 5);
  entry.backspace = entry.backspace || 0; // ЁЯФ╣ ensure backspace is saved

  // ЁЯПЖ Highest WPM logic
  let highest = 0;
  if (history.length > 0) {
    highest = Math.max(...history.map(h => parseInt(h.wpm)));
  }
  if (parseInt(entry.wpm) > highest) {
    localStorage.setItem("highestWpm", entry.wpm);
  }

  // тЬЕ Protect highest WPM record
  let highestWpm = parseInt(localStorage.getItem("highestWpm") || 0);
  let highestEntry = history.find(h => parseInt(h.wpm) === highestWpm);

  // рдирдпрд╛ record рдЬреЛрдбрд╝реЗрдВ
  history.push(entry);

  // тЬЕ рдЕрдЧрд░ records 20 рд╕реЗ рдЬреНрдпрд╛рджрд╛ рд╣реИрдВ рддреЛ oldest delete рдХрд░реЗрдВ (highest рдХреЛ рдЫреЛрдбрд╝рдХрд░)
  if (history.length > 20) {
    let filtered = history.filter(h => parseInt(h.wpm) === highestWpm);
    let remaining = history.filter(h => parseInt(h.wpm) !== highestWpm);
    if (remaining.length > 19) remaining = remaining.slice(-19);
    history = [...filtered, ...remaining];
  }

  // тЬЕ Save final list
  localStorage.setItem("typingHistory", JSON.stringify(history));
}
</script>

<script>
function downloadReport(){
  let history = JSON.parse(localStorage.getItem("typingHistory") || "[]");
  let deleted = JSON.parse(localStorage.getItem("deletedCount") || "{}");

  if(history.length === 0){ 
    alert("No history!"); 
    return; 
  }

  if (history.length > 20) history = history.slice(-20);

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  let userName = localStorage.getItem("userName") || "Anonymous";

  // Group by date
  let grouped = {};
  history.forEach(h=>{
    let d = h.date.split(",")[0];
    if(!grouped[d]) grouped[d] = [];
    grouped[d].push(h);
  });
  let lastDate = Object.keys(grouped).sort().pop();
  let tests = grouped[lastDate];

  // Summary calculation
  let totalTest = tests.length;
  let timeSpent = tests.reduce((a,b)=>a+parseInt(b.time),0);
  let lowest = Math.min(...tests.map(t=>parseInt(t.wpm)));
  let highest = Math.max(...tests.map(t=>parseInt(t.wpm)));
  let avgSpeed = (tests.reduce((a,b)=>a+parseInt(b.wpm),0)/totalTest).toFixed(0);
  let totalTyped = tests.reduce((a,b)=>a+b.totalWords,0);
  let totalCorrect = tests.reduce((a,b)=>a+b.correctWords,0);
  let avgAcc = (tests.reduce((a,b)=>a+parseInt(b.accuracy),0)/totalTest).toFixed(1);
  let totalBackspace = tests.reduce((a,b)=>a+(parseInt(b.backspace)||0),0); // тЬЕ Added
  let deletedCount = deleted[lastDate] || 0;

  // ===== Header =====
  doc.setFontSize(16);
  doc.text("ЁЯУЬ Typing Report (Last 20 Tests)", 14, 20);
  doc.setFontSize(12);
  doc.text("Name: " + userName + ", Report Date: " + new Date().toLocaleString(), 14, 30);

  // ===== Summary =====
  let y = 40;
  doc.setFontSize(13);
  doc.text("Summary ("+lastDate+")", 14, y);
  y += 8;
  doc.setFontSize(11);
  doc.text("Total Test: " + totalTest, 14, y); y+=6;
  doc.text("Time Spent: " + Math.round(timeSpent/60)+" m", 14, y); y+=6;
  doc.text("Lowest Speed: " + lowest, 14, y); y+=6;
  doc.text("Highest Speed: " + highest, 14, y); y+=6;
  doc.text("Avg Speed: " + avgSpeed, 14, y); y+=6;
  doc.text("Total Words: " + totalTyped, 14, y); y+=6;
  doc.text("Correct Words: " + totalCorrect, 14, y); y+=6;
  doc.text("Avg Accuracy: " + avgAcc+"%", 14, y); y+=6;
  doc.text("Total Backspace: " + totalBackspace, 14, y); y+=6; // тЬЕ New line
  doc.text("Deleted Test: " + deletedCount, 14, y); y+=10;

  // ===== Details Table =====
  doc.setFontSize(13);
  doc.text("ЁЯУЕ Detailed Report", 14, y);
  y+=8;
  doc.setFontSize(11);
  doc.text("Time", 14, y);
  doc.text("WPM", 60, y);
  doc.text("Acc.", 90, y);
  doc.text("Correct", 120, y);
  doc.text("Wrong", 150, y);
  doc.text("Words", 180, y);
  doc.text("Back", 205, y);
  y+=6;

  tests.forEach(h=>{
    doc.text(h.date, 14, y);
    doc.text(h.wpm.toString(), 60, y);
    doc.text(h.accuracy+"%", 90, y);
    doc.text(h.correctWords.toString(), 120, y);
    doc.text(h.wrongWords.toString(), 150, y);
    doc.text(h.totalWords.toString(), 180, y);
    doc.text((h.backspace||0).toString(), 205, y);
    y+=6;
    if(y > 280){
      doc.addPage();
      y=20;
    }
  });

  doc.save(userName.replace(/\s+/g,"_")+"_report.pdf");
}
</script>



<script>
function renderHistory() {
  const container = document.getElementById("historyTable");
  let history = JSON.parse(localStorage.getItem("typingHistory") || "[]");
  let deleted = JSON.parse(localStorage.getItem("deletedCount") || "{}");
  if (!container) return;

  if (history.length === 0) {
    container.innerHTML = "<p>No history yet.</p>";
    return;
  }

  // рдХреЗрд╡рд▓ 20 рд░рд┐рдХреЙрд░реНрдб
  if (history.length > 20) history = history.slice(-20);

  // Group by date
  const grouped = {};
  history.forEach(h => {
    const d = h.date.split(",")[0];
    if (!grouped[d]) grouped[d] = [];
    grouped[d].push(h);
  });

  const lastDate = Object.keys(grouped).sort().pop();
  const tests = grouped[lastDate];
  const userName = localStorage.getItem("userName") || "Anonymous";

  const totalTest = tests.length;
  const timeSpent = tests.reduce((a,b)=>a+parseInt(b.time),0);
  const lowest = Math.min(...tests.map(t=>parseInt(t.wpm)));
  const highest = Math.max(...tests.map(t=>parseInt(t.wpm)));
  const avgSpeed = (tests.reduce((a,b)=>a+parseInt(b.wpm),0)/totalTest).toFixed(0);
  const totalTyped = tests.reduce((a,b)=>a+b.totalWords,0);
  const totalCorrect = tests.reduce((a,b)=>a+b.correctWords,0);
  const avgAcc = (tests.reduce((a,b)=>a+parseInt(b.accuracy),0)/totalTest).toFixed(1);
  const totalBackspace = tests.reduce((a,b)=>a+(parseInt(b.backspace)||0),0); // тЬЕ рдХреБрд▓ Backspace
  const deletedCount = deleted[lastDate] || 0;

  // HTML Create
  let html = `
    <h2>ЁЯУЬ Typing Report (Last 20 Tests)</h2>
    <p><b>Name:</b> ${userName}, <b>Report Date:</b> ${new Date().toLocaleString()}
      <button onclick="downloadReport()">тмЗя╕П Download PDF</button></p>

    <table id="summaryTable" style="cursor:pointer;">
      <tr>
        <td><b>Date</b></td>
        <td>Total Tests</td>
        <td>Total Time</td>
        <td>Lowest</td>
        <td>Highest</td>
        <td>Avg Speed</td>
        <td>Total Words</td>
        <td>Total Correct</td>
        <td>Avg Accuracy</td>
        <td>Total Backspace</td>
        <td style="color:#007bff;"><b id="toggleText">ЁЯФ╜ Show</b></td>
      </tr>
      <tr>
        <td>${lastDate}</td>
        <td>${totalTest}</td>
        <td>${Math.round(timeSpent/60)}m</td>
        <td>${lowest}</td>
        <td>${highest}</td>
        <td>${avgSpeed}</td>
        <td>${totalTyped}</td>
        <td>${totalCorrect}</td>
        <td>${avgAcc}%</td>
        <td>${totalBackspace}</td>
        <td style="text-align:center;color:#007bff;">тЦ╝</td>
      </tr>
    </table>

    <div id="detailedReport" class="hidden">
      <h3 style="margin-top:15px;">ЁЯУЕ Detailed History (Recent 20 Records)</h3>
      <table>
        <tr>
          <td><b>Time Stamp</b></td>
          <td>WPM</td>
          <td>Acc. Speed</td>
          <td>Accuracy</td>
          <td>Time</td>
          <td>Correct</td>
          <td>Wrong</td>
          <td>Total Words</td>
          <td>Backspace</td>
        </tr>`;

  tests.forEach(h=>{
    const highlight = (parseInt(h.wpm) === highest)
      ? "background:#ffeb3b;font-weight:bold;color:#000;"
      : "";
    html += `
      <tr style="${highlight}">
        <td>${h.date}</td>
        <td>${h.wpm}</td>
        <td>${Math.round((h.wpm*h.accuracy)/100)}</td>
        <td>${h.accuracy}%</td>
        <td>${Math.round(h.time/60)} m</td>
        <td style="color:green;">${h.correctWords}</td>
        <td style="color:red;">${h.wrongWords}</td>
        <td>${h.totalWords}</td>
        <td>${h.backspace || 0}</td>
      </tr>`;
  });

  html += "</table></div>";
  container.innerHTML = html;

  // ЁЯЯв Toggle Show/Hide
  const summary = document.getElementById("summaryTable");
  const detail = document.getElementById("detailedReport");
  const toggleText = document.getElementById("toggleText");
  summary.addEventListener("click", () => {
    detail.classList.toggle("hidden");
    toggleText.textContent = detail.classList.contains("hidden") ? "ЁЯФ╜ Show" : "ЁЯФ╝ Hide";
  });
}
</script>


<script>
  // тЬЕ Custom passage function
function useCustomPassage(){
  let customText = document.getElementById("customPassage").value.trim();
  if(customText.length < 20){
    alert("Please paste at least 20 characters passage!");
    return;
  }
  textToType = customText;
  chars = toGraphemes(textToType);
  started=false; timeLeft=timeLimit;
  correctChars=0; wrongChars=0;
  input.value="";
  input.disabled=false;
  document.getElementById("stats").style.display="block";
  document.getElementById("result").style.display="none";
  restartBtn.style.display="none";
  textDiv.style.display="block";
  input.style.display="block";
  renderText([]);
  timeSpan.textContent=timeLimit;
  wpmSpan.textContent=0;
  accSpan.textContent=100;
}

</script>

<script>
function saveUserName(){
  let name = document.getElementById("userName").value.trim();
  if(name){
    localStorage.setItem("userName", name);
    alert("Name saved: " + name);
  } else {
    alert("Please enter a valid name!");
  }
  let userName = localStorage.getItem("userName") || prompt("Enter your name:");
if(userName){
   localStorage.setItem("userName", userName);
}

}

window.onload = function(){
  let savedName = localStorage.getItem("userName");
  if(savedName){
    document.getElementById("userName").value = savedName;
  }
  loadBestScore(); 
  initTest(); 
  if(localStorage.getItem("darkMode") === "true"){
    document.body.classList.add("dark-mode");
  }
};

</script>
  <script>
    // Get elements
const openFormBtn = document.getElementById("openFormBtn");
const popupForm = document.getElementById("popupForm");
const closeBtn = document.getElementById("closeBtn");

// Show the pop-up form when the button is clicked
openFormBtn.addEventListener("click", function() {
  popupForm.style.display = "flex";
});

// Close the pop-up form when the close button is clicked
closeBtn.addEventListener("click", function() {
  popupForm.style.display = "none";
});

// Close the pop-up form when clicking outside the form
window.addEventListener("click", function(event) {
  if (event.target === popupForm) {
    popupForm.style.display = "none";
  }
});

  </script>
<script>
  // тЬЕ Best Score load
function loadBestScore(){
  let best = localStorage.getItem("bestScore") || 0;
  document.getElementById("bestScore").textContent = best;
}

// тЬЕ Update Best Score рдЕрдЧрд░ рдирдпрд╛ WPM рдЬрд╝реНрдпрд╛рджрд╛ рд╣реИ
function updateBestScore(wpm){
  let best = localStorage.getItem("bestScore") || 0;
  if(parseInt(wpm) > parseInt(best)){
    localStorage.setItem("bestScore", wpm);
    document.getElementById("bestScore").textContent = wpm;
  }
}
</script>
<script>
function toggleDarkMode(){
  document.body.classList.toggle("dark-mode");
  localStorage.setItem("darkMode", document.body.classList.contains("dark-mode"));
}

window.addEventListener("DOMContentLoaded", ()=>{
  if(localStorage.getItem("darkMode") === "true"){
    document.body.classList.add("dark-mode");
  }
});
</script>
<script>
  // тЬЕ Time selector functionality
  document.querySelectorAll('.dropdown-content a').forEach(a => {
    a.addEventListener('click', function(e){
      e.preventDefault();
      const selected = parseInt(this.textContent.split(":")[0]);
      if (!isNaN(selected)) {
        timeLimit = selected * 60;
        initTest(); // Restart test with new time
      }
    });
  });

</script>
<script>
function highlightHighestScore() {
  let history = JSON.parse(localStorage.getItem("typingHistory") || "[]");
  if (history.length === 0) return;

  // ЁЯПЖ рд╕рдмрд╕реЗ рдмрдбрд╝рд╛ WPM рдЦреЛрдЬреЗрдВ
  let highest = Math.max(...history.map(h => parseInt(h.wpm)));
  localStorage.setItem("highestWpm", highest); // рд╕реЗрд╡ рдХрд░ рджреЛ рддрд╛рдХрд┐ рд╣рдореЗрд╢рд╛ рд░рд╣реЗ
}

</script>
<script>
  // тЬЕ Try Again button working
  document.getElementById("restartBtn").addEventListener("click", function() {
    initTest();   // рдЯрд╛рдЗрдкрд┐рдВрдЧ рдЯреЗрд╕реНрдЯ рдлрд┐рд░ рд╕реЗ рд╢реБрд░реВ рдХрд░реЗ
  });
</script>

<script>
function renderWpmChart(){
  let history = JSON.parse(localStorage.getItem("typingHistory") || "[]");
  if (history.length === 0) return;

  // ЁЯУЕ Group by Date тАФ find Best WPM & its duration
  let grouped = {};
  let dayDetails = {};
  history.forEach(h=>{
    let date = h.date.split(",")[0];
    let wpm = parseInt(h.wpm);
    let time = parseInt(h.time);
    let acc = parseFloat(h.accuracy);
    if(!grouped[date] || wpm > grouped[date]) {
      grouped[date] = wpm;
      dayDetails[date] = { wpm, duration: time, accuracy: acc };
    }
  });

  // ЁЯУЖ Filter only last 30 days
  const today = new Date();
  const last30 = Object.keys(grouped).filter(d=>{
    const dt = new Date(d);
    return (today - dt) / (1000 * 60 * 60 * 24) <= 30;
  }).sort((a,b)=>new Date(a)-new Date(b));

  const labels = last30;
  const wpmData = labels.map(d => dayDetails[d].wpm);
  const durationData = labels.map(d => Math.round(dayDetails[d].duration));

  const ctx = document.getElementById('wpmChart').getContext('2d');
  const isDark = document.body.classList.contains("dark-mode");
  const textColor = isDark ? "#fff" : "#000";
  const gridColor = isDark ? "#555" : "#ccc";

  if (window.wpmChartInstance) window.wpmChartInstance.destroy();

  window.wpmChartInstance = new Chart(ctx, {
    data: {
      labels: labels,
      datasets: [
        {
          type: 'line',
          label: 'Best Speed (WPM)',
          data: wpmData,
          borderColor: '#4caf50',
          backgroundColor: 'rgba(76,175,80,0.2)',
          borderWidth: 3,
          tension: 0.3,
          pointBackgroundColor: '#ff9800',
          fill: true,
          yAxisID: 'y'
        },
        {
          type: 'line',
          label: 'Duration (Seconds)',
          data: durationData,
          borderColor: '#e91e63',
          backgroundColor: 'rgba(233,30,99,0.2)',
          borderWidth: 2,
          tension: 0.4,
          pointBackgroundColor: '#e91e63',
          fill: false,
          yAxisID: 'y2'
        }
      ]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true,
          title: { display: true, text: 'Speed (WPM)', color: textColor },
          ticks: { color: textColor },
          grid: { color: gridColor }
        },
        y2: {
          beginAtZero: true,
          position: 'right',
          title: { display: true, text: 'Duration (Seconds)', color: textColor },
          ticks: { color: textColor },
          grid: { drawOnChartArea: false }
        },
        x: {
          title: { display: true, text: 'Date', color: textColor },
          ticks: { color: textColor },
          grid: { color: gridColor }
        }
      },
      plugins: {
        legend: {
          labels: { color: textColor }
        },
        tooltip: {
          callbacks: {
            label: (ctx) => {
              let date = ctx.label;
              let info = dayDetails[date];
              return [
                `WPM: ${info.wpm}`,
                `Duration: ${info.duration}s`,
                `Accuracy: ${info.accuracy}%`
              ];
            }
          }
        }
      }
    }
  });
}


// ЁЯХТ 24 рдШрдВрдЯреЗ рд╡рд╛рд▓рд╛ рдЪрд╛рд░реНрдЯ (рдЬреИрд╕рд╛ рдкрд╣рд▓реЗ рдерд╛)
function renderRecentChart(){
  let history = JSON.parse(localStorage.getItem("typingHistory") || "[]");
  if (history.length === 0) return;

  const now = new Date();
  const last24 = history.filter(h=>{
    const d = new Date(h.date);
    return (now - d) / (1000 * 60 * 60) <= 24;
  });

  if(last24.length === 0) return;

  const labels = last24.map(h => h.date.split(",")[1]?.trim() || h.date);
  const wpms = last24.map(h => parseInt(h.wpm));
  const accs = last24.map(h => parseFloat(h.accuracy));
  const times = last24.map(h => parseInt(h.time));

  const ctx = document.getElementById('recentChart').getContext('2d');
  const isDark = document.body.classList.contains("dark-mode");
  const textColor = isDark ? "#fff" : "#000";
  const gridColor = isDark ? "#555" : "#ccc";

  if (window.recentChartInstance) window.recentChartInstance.destroy();

  window.recentChartInstance = new Chart(ctx, {
    data: {
      labels: labels,
      datasets: [
        {
          type: 'bar',
          label: 'Speed (WPM)',
          data: wpms,
          backgroundColor: 'rgba(33,150,243,0.6)',
          borderColor: '#2196f3',
          borderWidth: 2
        },
        {
          type: 'line',
          label: 'Accuracy (%)',
          data: accs,
          borderColor: '#ff9800',
          backgroundColor: 'rgba(255,152,0,0.2)',
          borderWidth: 2,
          tension: 0.3,
          yAxisID: 'y2'
        }
      ]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true,
          title: { display: true, text: 'WPM', color: textColor },
          ticks: { color: textColor },
          grid: { color: gridColor }
        },
        y2: {
          beginAtZero: true,
          position: 'right',
          title: { display: true, text: 'Accuracy (%)', color: textColor },
          ticks: { color: textColor },
          grid: { drawOnChartArea: false }
        },
        x: {
          ticks: { color: textColor },
          grid: { color: gridColor }
        }
      },
      plugins: {
        legend: { labels: { color: textColor } },
        tooltip: {
          callbacks: {
            label: (ctx) => {
              const i = ctx.dataIndex;
              if(ctx.dataset.label.includes("Speed")){
                return [
                  `WPM: ${wpms[i]}`,
                  `Accuracy: ${accs[i]}%`,
                  `Duration: ${times[i]}s`
                ];
              } else {
                return null;
              }
            }
          }
        }
      }
    }
  });
}

// ЁЯУК рджреЛрдиреЛрдВ рдЪрд╛рд░реНрдЯ render рдХрд░реЗрдВ
function renderAllCharts(){
  renderWpmChart();
  renderRecentChart();
}

// Auto load + dark mode observer
window.addEventListener("load", renderAllCharts);
document.addEventListener("DOMContentLoaded", ()=>{
  const observer = new MutationObserver(renderAllCharts);
  observer.observe(document.body, { attributes: true, attributeFilter: ['class'] });
});
</script>
<script>


function toggleTest() {
  const btn = document.getElementById("finishBtn");
  const input = document.getElementById("input");

  // рдЕрдЧрд░ рдЯреЗрд╕реНрдЯ рдЪрд▓ рд░рд╣рд╛ рд╣реИ рддреЛ рд░реЛрдХ рджреЛ
  if (testRunning || started) {
    // тЬЕ рдирдпрд╛: рдпреВрдЬрд╝рд░ рд╕реЗ рдкреБрд╖реНрдЯрд┐ рд▓реЛ
    const confirmFinish = confirm("Are you sure you want to finish the test?");
    if (!confirmFinish) return; // тЭМ рдпреВрдЬрд╝рд░ рдиреЗ Cancel рдХрд┐рдпрд╛ рддреЛ рдХреБрдЫ рдордд рдХрд░реЛ

    testRunning = false;
    started = false;
    btn.textContent = "тЦ╢я╕П";
    btn.style.background = "#4caf50"; // ЁЯЯв Start рд░рдВрдЧ
    finishTest();
  } 
  else {
    // тЦ╢я╕П Start Test
    testRunning = true;
    started = true;
    btn.textContent = "тП╣";
    btn.style.background = "#e91e63"; // ЁЯФ┤ Stop рд░рдВрдЧ
    initTest();
    input.focus();
  }
}

let testRunning = false; // рд╕реНрдерд┐рддрд┐ рдЯреНрд░реИрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП
document.getElementById("input").addEventListener("focus", () => {
  if (!started && !testRunning) {
    toggleTest();
  }
});


// рдкреЗрдЬ рд▓реЛрдб рдкрд░ рдмрдЯрди рдХреЛ рд╣рд░рд╛ рд░рдЦреЛ
window.addEventListener("load", () => {
  const btn = document.getElementById("finishBtn");
  btn.style.background = "#4caf50";
});
</script>



<script>
let typingMode = localStorage.getItem("typingMode") || "character"; // рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдореЛрдб

// рдмрдЯрди рдЯреЗрдХреНрд╕реНрдЯ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдлрд╝рдВрдХреНрд╢рди
function updateModeButton() {
  const btn = document.getElementById("modeToggleBtn");
  btn.textContent = "ЁЯФд Mode: " + (typingMode === "character" ? "Character" : "Word");
}

// Toggle рдмрдЯрди рдХреНрд▓рд┐рдХ
function toggleMode() {
  typingMode = (typingMode === "character") ? "word" : "character";
  localStorage.setItem("typingMode", typingMode);
  updateModeButton();
  initTest(); // рдирдпрд╛ рдореЛрдб рддреБрд░рдВрдд рд▓рд╛рдЧреВ
}

// рдЯреЗрд╕реНрдЯ рд╢реБрд░реВ рд╣реЛрддреЗ рд╣реА рдмрдЯрди рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВ
window.addEventListener("load", updateModeButton);
</script>

<script>
let backspaceEnabled = JSON.parse(localStorage.getItem("backspaceEnabled") || "true");

function toggleBackspace() {
  backspaceEnabled = !backspaceEnabled;
  localStorage.setItem("backspaceEnabled", backspaceEnabled);
  updateBackspaceButton();
}

// рдмрдЯрди рдХрд╛ рдЯреЗрдХреНрд╕реНрдЯ рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВ
function updateBackspaceButton() {
  const btn = document.getElementById("backspaceToggleBtn");
  btn.textContent = "тМл Backspace: " + (backspaceEnabled ? "ON" : "OFF");
  btn.style.background = backspaceEnabled ? "#4caf50" : "#f44336";
}

// рдЯрд╛рдЗрдкрд┐рдВрдЧ рдЗрдирдкреБрдЯ рдкрд░ рдмреИрдХрд╕реНрдкреЗрд╕ рд░реЛрдХреЗрдВ
document.addEventListener("keydown", function(e) {
  if (!backspaceEnabled && e.key === "Backspace") {
    e.preventDefault();
  }
});

// рдкреЗрдЬ рд▓реЛрдб рдкрд░ рдмрдЯрди рд╕реНрдЯреЗрдЯ рд╕реЗрдЯ рдХрд░реЗрдВ
window.addEventListener("load", updateBackspaceButton);
</script>
<script>
// рдЬрдм рдпреВрдЬрд╝рд░ textarea рдореЗрдВ рдлреЛрдХрд╕ рдХрд░реЗ рддреЛ рдСрдЯреЛ рд╕реНрдЯрд╛рд░реНрдЯ рд╣реЛ рдЬрд╛рдП
document.getElementById("input").addEventListener("focus", () => {
  const btn = document.getElementById("finishBtn");

  // рдЕрдЧрд░ рдЕрднреА рдЯреЗрд╕реНрдЯ рдирд╣реАрдВ рдЪрд▓ рд░рд╣рд╛ рд╣реИ, рддреЛ рд╢реБрд░реВ рдХрд░реЗрдВ
  if (!testRunning) {
    testRunning = true;
    started = true;
    btn.textContent = "тП╣"; // Stop рдмрдЯрди рджрд┐рдЦрд╛рдУ
    initTest();             // рдирдпрд╛ рдЯреЗрд╕реНрдЯ рд╢реБрд░реВ
  }
});
</script>


</body>
</html>

       
      
      
      

     
    </div>
  </div>
  <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 20px;">
    <a href="https://www.copyscape.com/" target="_blank">
        <img src="//banners.copyscape.com/img/copyscape-banner-blue-130x46.png" width="130" height="55" border="0" alt="Protected by Copyscape" title="Protected by Copyscape - Do not copy content from this page." />
    </a>
    <a href="//www.dmca.com/Protection/Status.aspx?ID=d3b3907b-b880-412d-8661-4c7109eb787c" title="DMCA.com Protection Status" class="dmca-badge" target="_blank"> 
        <img src="https://images.dmca.com/Badges/dmca_protected_1_120.png?ID=d3b3907b-b880-412d-8661-4c7109eb787c" alt="DMCA.com Protection Status" />
    </a>
    <script src="https://images.dmca.com/Badges/DMCABadgeHelper.min.js"></script>

  </div>


  </main>
  <footer>
   <p>Copyright 2025. All rights reserved.</p>
  </footer>
</body>
</html>
